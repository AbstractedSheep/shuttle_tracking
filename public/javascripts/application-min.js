var buses=new Hash();var map;function initialize(){map=new google.maps.Map2(document.getElementById("map_canvas"));map.setCenter(new google.maps.LatLng(42.73075,-73.67652),15);map.setUIToDefault();map.setMapType(G_HYBRID_MAP);update()}function update(){jQuery.getJSON(status_url+"?callback=?",function(b){var a=buses.keys();jQuery.each(b,function(e,f){var c=new GLatLng(f.position.latitude,f.position.longitude);var g=f.position.shuttle.id;var d=buses.get(g);if(d!=undefined){map.removeOverlay(d);buses.unset(g)}var d=createMarker(c,f.position);buses.set(g,d);a=a.without(g);map.addOverlay(d)});remove(a)})}function shuttle_icon(c,e,a){var d=new GIcon();d.image=icon_url+"/"+c+".png";d.printImage=icon_url+"/"+c+".gif";d.mozPrintImage=icon_url+"/"+c+".jpg";var b=e/2;var f=a/2;d.iconSize=new GSize(e,a);d.iconAnchor=new GPoint(b,f);d.infoWindowAnchor=new GPoint(b,f);return d}function createMarker(b,a){var d=shuttle_icon(a.heading,parseInt(a.icon_width),parseInt(a.icon_height));moptions={icon:d};var c=new GMarker(b,moptions);GEvent.addListener(c,"click",function(){c.openInfoWindowHtml(generateHTML(a))});return c}function generateHTML(a){var b=new Array();b.push(a.shuttle.name);b.push("<br>Speed: ");b.push(a.speed);b.push("mph Heading: ");b.push(a.heading);b.push("&deg;");if((a.status!=undefined)&&(a.status.message.length>0)){b.push("<br>Status: ");b.push(a.status.message)}return b.join("")}function remove(a){jQuery.each(a,function(c,d){var b=buses.get(d);map.removeOverlay(b);buses.unset(d)})};