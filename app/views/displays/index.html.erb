<% content_for :js_ready do %>
    var point = {latitude: <%= MAP_CENTER[:lat] %>, longitude: <%= MAP_CENTER[:long] %>};
    map = setup_map(point, 15);
    $.ajaxSetup({
      timeout: <%= AJAX_TIMEOUT %>
    });
    $('#status').ajaxError(function(e, xhr, settings, exception){
      $(this).text("Unable to load data.");
      $('#loading_icon').hide();
      $('#error_icon').show();
    });
    $('#status').ajaxStart(function(){
      $(this).text("Loading...");
      $('#error_icon').hide();
      $('#loading_icon').show();
    });
    $('#status').ajaxSuccess(function(){
      $('#loading_icon').hide();
    });
    updater = setInterval("update()", <%= UPDATE_INTERVAL %>);
    routes_and_stops();
    update(); //Run the first update instead of waiting.
<% end %>
<% content_for :js do %>
  var current_data_path = '<%= current_vehicles_path(:format => 'js') %>';
  var netlink_data_path = '<%= displays_netlink_path(:format => 'js') %>';
  var base_icon = '<%= rotate_icon_path(:id => ':id', :heading => ':heading', :format => 'png') %>';
  var stop_icon_path = '<%= image_path "blue_dot.png" %>';
<% end %>
<div id="shuttle_logo"></div>
<div id="mapblock">
  <div id="map_canvas"></div>
  <div id="nav_container">
    <%= link_to "http://webtech.union.rpi.edu" do %>
      <%= image_tag 'little_wtg_logo.png', :alt => "Web Tech Group" %>
    <% end %>
    <div id="nav">
      <a id="about_button" href="#">About</a>
      <a id="faq_button" href="#">FAQ</a>
      <%= link_to "KML", displays_netlink_path(:format => 'kml') %>
      <a href="http://webtech.union.rpi.edu/ticket">Contact</a>
      <a href="http://github.com/wtg/shuttle_tracking">Source</a>
    </div>
  </div>
</div>
<div id="map_header">
      <span id="loading_icon" style="display: none;"><%= image_tag 'full_map/loading.gif' %></span>
      <span id="error_icon" style="display: none;"><%= image_tag 'full_map/error.png' %></span>
      <span id="status">Loading...</span>
</div>
<div id="left"></div>
<div id="top"></div>
<div id="right"></div>
<div id="bottom"></div>
<div class="hoverdiv" id="about">
  <p>Shuttle Tracking is designed and maintained by the Student Senate <a href="http://webtech.union.rpi.edu/">Web Technologies Group</a>.</p>
  <p>This service is supported by the <a href="http://www.rpi.edu/dept/parking/">Parking and Transportation Office</a>, the <a href="http://www.rpi.edu/dept/administration/"> Administration Division</a> and <a href="http://dotcio.rpi.edu/setup.do">dotCIO</a>.</p>
  <p>Much of the code behind Shuttle Tracking comes from <a href="http://projects.brispace.net/category/geo/">Flagship Geo</a>, an open source mapping project sponsored by <a href="http://rcos.cs.rpi.edu/"><abbr title="Rensselaer Center for Open Source Software">RCOS</abbr></a>.</p>
  <p><a class="close" href="#" id="about_close">Close</a></p>
</div>
<div class="hoverdiv" id="faq">
  <p>Coming soon...</p>
  <p><a class="close" href="#" id="faq_close">Close</a></p>
</div>
<script>
  $("#about_button").click(function () {
      $("#about").toggle();
      $("#faq").hide();
      return false;
    });
  $("#about_close").click(function () {
      $("#about").hide();
      return false;
    });
  $("#faq_button").click(function () {
      $("#faq").toggle();
      $("#about").hide();
      return false;
    });
  $("#faq_close").click(function () {
      $("#faq").hide();
      return false;
    });
</script>
